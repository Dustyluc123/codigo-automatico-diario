<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compre Online | Sua Loja de Produtos Variados com Ótimos Preços</title>
    <meta name="description" content="Encontre os melhores produtos online! Grande variedade em eletrônicos, moda, casa e jardim, brinquedos e muito mais. Compre agora com segurança e entrega rápida.">
    <meta name="keywords" content="loja online, comprar online, produtos online, eletrônicos, moda, casa e jardim, brinquedos, promoção, desconto">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        header {
            background-color: #333;
            color: white;
            padding: 1em;
            text-align: center;
            position: relative;
        }

        nav ul {
            list-style: none;
            padding: 0;
        }

        nav ul li {
            display: inline;
            margin: 0 10px;
        }

        nav a {
            color: white;
            text-decoration: none;
        }

        main {
            padding: 20px;
        }

        .featured-products {
            text-align: center;
            margin-bottom: 20px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .product-card {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .product-card img {
            max-width: 100%;
            height: auto;
        }

        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 1em;
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        .cart-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
        }

        .cart-count {
            position: absolute;
            top: 0;
            right: 0;
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.8em;
        }

        .auth-form {
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .auth-form label {
            display: block;
            margin-bottom: 5px;
        }

        .auth-form input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .auth-form button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .auth-form button:hover {
            background-color: #3e8e41;
        }

        .error-message {
            color: red;
            margin-top: 5px;
        }

        #login-section, #register-section {
            display: none;
        }

        #user-greeting {
          text-align: right;
          padding-right: 20px;
          color: green;
        }

        /* Checkout styles */
        #checkout-section {
            display: none;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #checkout-section h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        #checkout-section label {
            display: block;
            margin-bottom: 5px;
        }

        #checkout-section input, #checkout-section select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #checkout-section button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #checkout-section button:hover {
            background-color: #3e8e41;
        }

        #cart-items {
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .cart-item img {
            max-width: 50px;
            max-height: 50px;
            margin-right: 10px;
        }

        .cart-item-details {
            flex-grow: 1;
        }

        /* Search bar styles */
        #search-container {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        #search-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Filter styles */
        .filter-section {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .filter-section h3 {
            margin-top: 0;
        }

        .filter-section label {
            display: block;
            margin-bottom: 5px;
        }

        /* Sorting styles */
        #sorting-options {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #sorting-options label {
            margin-right: 10px;
        }

        /* Rating styles */
        .rating {
            display: inline-block;
        }

        .rating input {
            display: none;
        }

        .rating label {
            float: right;
            cursor: pointer;
            color: #ddd;
        }

        .rating label:before {
            content: "\2605"; /* Star character */
            font-size: 20px;
        }

        .rating input:checked ~ label {
            color: #ffc107;
        }

        .rating label:hover, .rating label:hover ~ label {
            color: #ffc107;
        }

        .average-rating {
            font-size: 16px;
            color: #555;
        }

    </style>
</head>
<body>
    <header>
        <h1>Loja Online</h1>
        <nav>
            <ul>
                <li><a href="#">Início</a></li>
                <li><a href="#">Produtos</a></li>
                <li><a href="#">Sobre Nós</a></li>
                <li><a href="#">Contato</a></li>
                <li id="login-register-links">
                    <a href="#" id="login-link">Login</a>
                    <a href="#" id="register-link">Registrar</a>
                </li>
                <li id="logout-link" style="display: none;"><a href="#">Logout</a></li>
            </ul>
        </nav>
        <div class="cart-icon">
            <a href="#" id="cart-link">Carrinho</a>
            <span id="cart-count" class="cart-count">0</span>
        </div>
        <div id="user-greeting"></div>

        <!-- Search Bar -->
        <div id="search-container">
            <input type="text" id="search-input" placeholder="Pesquisar produtos...">
        </div>

    </header>

    <main>

        <section id="login-section" class="auth-form">
            <h2>Login</h2>
            <form id="login-form">
                <label for="login-email">Email:</label>
                <input type="email" id="login-email" name="login-email" required>
                <label for="login-password">Senha:</label>
                <input type="password" id="login-password" name="login-password" required>
                <button type="submit">Entrar</button>
                <div id="login-error" class="error-message"></div>
            </form>
        </section>

        <section id="register-section" class="auth-form">
            <h2>Registrar</h2>
            <form id="register-form">
                <label for="register-name">Nome:</label>
                <input type="text" id="register-name" name="register-name" required>
                <label for="register-email">Email:</label>
                <input type="email" id="register-email" name="register-email" required>
                <label for="register-password">Senha:</label>
                <input type="password" id="register-password" name="register-password" required>
                <button type="submit">Registrar</button>
                <div id="register-error" class="error-message"></div>
            </form>
        </section>

        <section class="filter-section">
            <h3>Filtrar Produtos</h3>

            <div>
                <h4>Categorias</h4>
                <label><input type="checkbox" name="category" value="eletronicos"> Eletrônicos</label>
                <label><input type="checkbox" name="category" value="moda"> Moda</label>
                <label><input type="checkbox" name="category" value="casa"> Casa e Jardim</label>
                <label><input type="checkbox" name="category" value="brinquedos"> Brinquedos</label>
            </div>

            <div>
                <h4>Preço</h4>
                <label for="price-min">Mínimo:</label>
                <input type="number" id="price-min" name="price-min" value="0">
                <label for="price-max">Máximo:</label>
                <input type="number" id="price-max" name="price-max" value="100">
            </div>

            <div>
                <h4>Avaliação</h4>
                <label><input type="radio" name="rating" value="1"> 1 Estrela</label>
                <label><input type="radio" name="rating" value="2"> 2 Estrelas</label>
                <label><input type="radio" name="rating" value="3"> 3 Estrelas</label>
                <label><input type="radio" name="rating" value="4"> 4 Estrelas</label>
                <label><input type="radio" name="rating" value="5"> 5 Estrelas</label>
            </div>
            <button id="apply-filters">Aplicar Filtros</button>
        </section>

        <section id="sorting-options">
            <h3>Ordenar Produtos</h3>
            <label>
                <input type="radio" name="sort" value="price_asc"> Preço (Crescente)
            </label>
            <label>
                <input type="radio" name="sort" value="price_desc"> Preço (Decrescente)
            </label>
            <label>
                <input type="radio" name="sort" value="rating_desc"> Avaliação (Maior para Menor)
            </label>
        </section>

        <section class="featured-products">
            <h2>Produtos em Destaque</h2>
            <p>Confira nossos produtos mais populares!</p>
            <div id="featured-products-container"></div>
        </section>

        <section class="product-grid" id="product-grid">
            <!-- Products will be dynamically added here -->
        </section>

        <!-- Checkout Section -->
        <section id="checkout-section">
            <h2>Checkout</h2>
            <div id="cart-items"></div>
            <form id="checkout-form">
                <label for="name">Nome Completo:</label>
                <input type="text" id="name" name="name" required>

                <label for="address">Endereço de Entrega:</label>
                <input type="text" id="address" name="address" required>

                <label for="payment-method">Método de Pagamento:</label>
                <select id="payment-method" name="payment-method">
                    <option value="credit-card">Cartão de Crédito</option>
                    <option value="boleto">Boleto</option>
                </select>

                <button type="submit">Finalizar Compra</button>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2023 Loja Online. Todos os direitos reservados.</p>
        <p>Contato: contato@lojaonline.com</p>
    </footer>

    <script>
        const products = [
            {
                id: 1,
                name: "Produto 1",
                price: 25.99,
                image: "https://via.placeholder.com/150",
                description: "Este é o produto 1. Ótima qualidade!",
                category: "eletronicos",
                rating: 4
            },
            {
                id: 2,
                name: "Produto 2",
                price: 49.50,
                image: "https://via.placeholder.com/150",
                description: "Este é o produto 2. Imperdível!",
                category: "moda",
                rating: 3
            },
            {
                id: 3,
                name: "Produto 3",
                price: 19.99,
                image: "https://via.placeholder.com/150",
                description: "Este é o produto 3. O melhor do mercado!",
                category: "casa",
                rating: 5
            },
            {
                id: 4,
                name: "Produto 4",
                price: 75.00,
                image: "https://via.placeholder.com/150",
                description: "Este é o produto 4. Para você que exige o melhor!",
                category: "brinquedos",
                rating: 2
            },
            {
                id: 5,
                name: "Produto 5",
                price: 120.00,
                image: "https://via.placeholder.com/150",
                description: "Este é o produto 5. A melhor escolha!",
                category: "eletronicos",
                rating: 5
            }
        ];

        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        const productGrid = document.getElementById('product-grid');
        const cartCountElement = document.getElementById('cart-count');
        const cartLink = document.getElementById('cart-link');
        const checkoutSection = document.getElementById('checkout-section');
        const cartItemsContainer = document.getElementById('cart-items');
        const checkoutForm = document.getElementById('checkout-form');
        const searchInput = document.getElementById('search-input');
        const applyFiltersButton = document.getElementById('apply-filters');
        const sortingOptions = document.getElementById('sorting-options');

        function updateCartCount() {
            cartCountElement.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
            }
        }

        function getAverageRating(productId) {
            const ratings = JSON.parse(localStorage.getItem(`ratings-${productId}`)) || [];
            if (ratings.length === 0) {
                return 0;
            }
            const sum = ratings.reduce((a, b) => a + b, 0);
            return sum / ratings.length;
        }

        function renderStars(averageRating) {
            const roundedRating = Math.round(averageRating);
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += i <= roundedRating ? '★' : '☆';
            }
            return stars;
        }


        function displayProducts(productList) {
            productGrid.innerHTML = ''; // Clear existing products

            productList.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');

                const averageRating = getAverageRating(product.id);
                const stars = renderStars(averageRating);

                productCard.innerHTML = `
                    <h3>${product.name}</h3>
                    <img src="${product.image}" alt="${product.name}">
                    <p>${product.description}</p>
                    <p>R$ ${product.price.toFixed(2)}</p>
                    <div class="average-rating">Avaliação Média: ${stars} (${averageRating.toFixed(1)})</div>
                    <div class="rating">
                        <input type="radio" id="star5-${product.id}" name="rating-${product.id}" value="5" /><label for="star5-${product.id}" title="5 stars">★</label>
                        <input type="radio" id="star4-${product.id}" name="rating-${product.id}" value="4" /><label for="star4-${product.id}" title="4 stars">★</label>
                        <input type="radio" id="star3-${product.id}" name="rating-${product.id}" value="3" /><label for="star3-${product.id}" title="3 stars">★</label>
                        <input type="radio" id="star2-${product.id}" name="rating-${product.id}" value="2" /><label for="star2-${product.id}" title="2 stars">★</label>
                        <input type="radio" id="star1-${product.id}" name="rating-${product.id}" value="1" /><label for="star1-${product.id}" title="1 star">★</label>
                    </div>
                    <button onclick="addToCart(${product.id})">Adicionar ao Carrinho</button>
                `;

                productGrid.appendChild(productCard);

                // Rating event listeners
                const ratingInputs = productCard.querySelectorAll('input[name^="rating-"]');
                ratingInputs.forEach(input => {
                    input.addEventListener('change', function() {
                        const rating = parseInt(this.value);
                        const productId = product.id;
                        let ratings = JSON.parse(localStorage.getItem(`ratings-${productId}`)) || [];
                        ratings.push(rating);
                        localStorage.setItem(`ratings-${productId}`, JSON.stringify(ratings));

                        // Re-render the products to update the average rating display
                        displayProducts(products);
                    });
                });
            });
        }

        // Initial display of all products
        displayProducts(products);

        // Example of displaying a featured product (first product in the array)
        const featuredProductsContainer = document.getElementById('featured-products-container');
        if (products.length > 0) {
            const featuredProduct = products[0];
            const featuredProductElement = document.createElement('div');

             const averageRating = getAverageRating(featuredProduct.id);
             const stars = renderStars(averageRating);

            featuredProductElement.innerHTML = `
                <h3>${featuredProduct.name}</h3>
                <img src="${featuredProduct.image}" alt="${featuredProduct.name}">
                <p>${featuredProduct.description}</p>
                <p>R$ ${featuredProduct.price.toFixed(2)}</p>
                <div class="average-rating">Avaliação Média: ${stars} (${averageRating.toFixed(1)})</div>
                <div class="rating">
                    <input type="radio" id="star5-${featuredProduct.id}" name="rating-${featuredProduct.id}" value="5" /><label for="star5-${featuredProduct.id}" title="5 stars">★</label>
                    <input type="radio" id="star4-${featuredProduct.id}" name="rating-${featuredProduct.id}" value="4" /><label for="star4-${featuredProduct.id}" title="4 stars">★</label>
                    <input type="radio" id="star3-${featuredProduct.id}" name="rating-${featuredProduct.id}" value="3" /><label for="star3-${featuredProduct.id}" title="3 stars">★</label>
                    <input type="radio" id="star2-${featuredProduct.id}" name="rating-${featuredProduct.id}" value="2" /><label for="star2-${featuredProduct.id}" title="2 stars">★</label>
                    <input type="radio" id="star1-${featuredProduct.id}" name="rating-${featuredProduct.id}" value="1" /><label for="star1-${featuredProduct.id}" title="1 star">★</label>
                </div>
                <button onclick="addToCart(${featuredProduct.id})">Adicionar ao Carrinho</button>
            `;
            featuredProductsContainer.appendChild(featuredProductElement);
        }

        // Function to display cart items in the checkout
        function displayCartItems() {
            cartItemsContainer.innerHTML = '';
            if (cart.length === 0) {
                cartItemsContainer.textContent = 'O carrinho está vazio.';
                return;
            }

            cart.forEach(item => {
                const cartItemDiv = document.createElement('div');
                cartItemDiv.classList.add('cart-item');

                cartItemDiv.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="cart-item-details">
                        <h4>${item.name}</h4>
                        <p>Quantidade: ${item.quantity}</p>
                        <p>Preço Unitário: R$ ${item.price.toFixed(2)}</p>
                        <p>Subtotal: R$ ${(item.quantity * item.price).toFixed(2)}</p>
                    </div>
                `;

                cartItemsContainer.appendChild(cartItemDiv);
            });
        }

        // Event listener for the cart link to show the checkout section
        cartLink.addEventListener('click', (e) => {
            e.preventDefault();
            checkoutSection.style.display = 'block';
            displayCartItems(); // Display cart items when checkout is opened
        });

        // Event listener for the checkout form submission
        checkoutForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const address = document.getElementById('address').value;
            const paymentMethod = document.getElementById('payment-method').value;

            alert(`Compra finalizada com sucesso!\nNome: ${name}\nEndereço: ${address}\nPagamento: ${paymentMethod}`);
            // Clear the cart after successful checkout (simulated)
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            checkoutSection.style.display = 'none';
        });

        updateCartCount();

        // Authentication logic
        const loginLink = document.getElementById('login-link');
        const registerLink = document.getElementById('register-link');
        const loginSection = document.getElementById('login-section');
        const registerSection = document.getElementById('register-section');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginError = document.getElementById('login-error');
        const registerError = document.getElementById('register-error');
        const loginRegisterLinks = document.getElementById('login-register-links');
        const logoutLink = document.getElementById('logout-link');
        const userGreeting = document.getElementById('user-greeting');

        let users = JSON.parse(localStorage.getItem('users')) || [];
        let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser')) || null;

        function displayGreeting() {
            if (loggedInUser) {
                userGreeting.textContent = `Olá, ${loggedInUser.name}!`;
                loginRegisterLinks.style.display = 'none';
                logoutLink.style.display = 'inline';
            } else {
                userGreeting.textContent = '';
                loginRegisterLinks.style.display = 'inline';
                logoutLink.style.display = 'none';
            }
        }

        function logout() {
            loggedInUser = null;
            localStorage.removeItem('loggedInUser');
            displayGreeting();
            alert('Logout realizado com sucesso!');
        }

        logoutLink.addEventListener('click', (e) => {
          e.preventDefault();
          logout();
        });

        loginLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginSection.style.display = 'block';
            registerSection.style.display = 'none';
        });

        registerLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerSection.style.display = 'block';
            loginSection.style.display = 'none';
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                loggedInUser = user;
                localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
                loginSection.style.display = 'none';
                displayGreeting();
                alert('Login realizado com sucesso!');
            } else {
                loginError.textContent = 'Email ou senha incorretos.';
            }
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;

            if (users.find(u => u.email === email)) {
                registerError.textContent = 'Este email já está registrado.';
                return;
            }

            const newUser = { name, email, password };
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            loggedInUser = newUser;
            localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
            registerSection.style.display = 'none';
            displayGreeting();
            alert('Registro realizado com sucesso!');
        });

        displayGreeting();

        // Search Functionality
        searchInput.addEventListener('input', function() {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredProducts = products.filter(product => {
                return product.name.toLowerCase().includes(searchTerm) ||
                       product.description.toLowerCase().includes(searchTerm);
            });
            displayProducts(filteredProducts);
        });

        // Filter Functionality
        applyFiltersButton.addEventListener('click', function() {
            const categoryFilters = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(checkbox => checkbox.value);
            const minPrice = parseFloat(document.getElementById('price-min').value) || 0;
            const maxPrice = parseFloat(document.getElementById('price-max').value) || Infinity;
            const ratingFilter = parseInt(document.querySelector('input[name="rating"]:checked')?.value) || 0;

            const filteredProducts = products.filter(product => {
                // Category filter
                if (categoryFilters.length > 0 && !categoryFilters.includes(product.category)) {
                    return false;
                }

                // Price filter
                if (product.price < minPrice || product.price > maxPrice) {
                    return false;
                }

                // Rating filter
                if (ratingFilter > 0 && product.rating !== ratingFilter) {
                    return false;
                }

                return true;
            });

            displayProducts(filteredProducts);
        });

        // Sorting Functionality
        sortingOptions.addEventListener('change', function() {
            const sortValue = document.querySelector('input[name="sort"]:checked')?.value;

            let sortedProducts = [...products]; // Create a copy to avoid modifying the original array

            switch (sortValue) {
                case 'price_asc':
                    sortedProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price_desc':
                    sortedProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'rating_desc':
                    sortedProducts.sort((a, b) => {
                        const ratingA = getAverageRating(a.id);
                        const ratingB = getAverageRating(b.id);
                        return ratingB - ratingA;
                    });
                    break;
                default:
                    // No sorting
                    break;
            }

            displayProducts(sortedProducts);
        });

        // Test Framework
        const assertEquals = (expected, actual, message) => {
            if (expected !== actual) {
                console.error(`Test Failed: ${message} - Expected: ${expected}, Actual: ${actual}`);
            }
        };

        const testAddToCart = () => {
          // Setup
          localStorage.removeItem('cart');
          cart = [];

          // Test Case 1: Adding a new product to the cart
          addToCart(1);
          assertEquals(1, cart.length, "Test Case 1 Failed: Cart should have 1 item");
          assertEquals(1, cart[0].quantity, "Test Case 1 Failed: Quantity should be 1");

          // Test Case 2: Adding the same product again
          addToCart(1);
          assertEquals(1, cart.length, "Test Case 2 Failed: Cart should still have 1 item");
          assertEquals(2, cart[0].quantity, "Test Case 2 Failed: Quantity should be 2");

          // Test Case 3: Adding a different product
          addToCart(2);
          assertEquals(2, cart.length, "Test Case 3 Failed: Cart should have 2 items");
          assertEquals(1, cart[1].quantity, "Test Case 3 Failed: Quantity should be 1");

          // Test Case 4: Check the cart total count
          updateCartCount();
          assertEquals("3", cartCountElement.textContent, "Test Case 4 Failed: Cart count should be 3");

          // Cleanup
          localStorage.removeItem('cart');
          cart = [];
          updateCartCount();
        };

        // Run Tests
        testAddToCart();

    </script>
</body>
</html>